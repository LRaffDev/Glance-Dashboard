# =======================
# Hosting PAGE
# =======================
  - name: Hosting
    columns:

      # -----------------------
      # SMALL COLUMN
      # -----------------------
      - size: small
        widgets:

          # https://github.com/glanceapp/community-widgets/blob/main/widgets/uptime-kuma/README.md        

            - type: custom-api
            title: Uptime Kumas
            title-url: ${UPTIME_KUMA_URL}
            url: ${UPTIME_KUMA_URL}/api/status-page/${UPTIME_KUMA_STATUS_SLUG}
            subrequests:
                heartbeats:
                url: ${UPTIME_KUMA_URL}/api/status-page/heartbeat/${UPTIME_KUMA_STATUS_SLUG}
            cache: 10m
            template: |
                {{ $hb := .Subrequest "heartbeats" }}

                {{ if not (.JSON.Exists "publicGroupList") }}
                <p class="color-negative">Error reading response</p>
                {{ else if eq (len (.JSON.Array "publicGroupList")) 0 }}
                <p>No monitors found</p>
                {{ else }}

                <ul class="dynamic-columns list-gap-8">
                {{ range .JSON.Array "publicGroupList" }}
                {{ range .Array "monitorList" }}
                {{ $id := .String "id" }}
                {{ $hbArray := $hb.JSON.Array (print "heartbeatList." $id) }}
                <div class="flex items-center gap-12">
                    <a class="size-title-dynamic color-highlight text-truncate block grow" href="${UPTIME_KUMA_URL}/dashboard/{{ $id }}"
                    target="_blank" rel="noreferrer">
                    {{ .String "name" }} </a>

                    {{ if gt (len $hbArray) 0 }}
                    {{ $latest := index $hbArray (sub (len $hbArray) 1) }}
                    {{ if eq ($latest.Int "status") 1 }}
                    <div>{{ $latest.Int "ping" }}ms</div>
                    <div class="monitor-site-status-icon-compact" title="OK">
                        <svg fill="var(--color-positive)" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                        <path fill-rule="evenodd"
                            d="M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16Zm3.857-9.809a.75.75 0 0 0-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 1 0-1.06 1.061l2.5 2.5a.75.75 0 0 0 1.137-.089l4-5.5Z"
                            clip-rule="evenodd"></path>
                        </svg>
                    </div>
                    {{ else }}
                    <div><span class="color-negative">DOWN</span></div>
                    <div class="monitor-site-status-icon-compact" title="{{ if $latest.Exists "msg" }}{{ $latest.String "msg" }}{{ else
                        }}Error{{ end }}">
                        <svg fill="var(--color-negative)" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                        <path fill-rule="evenodd"
                            d="M8.485 2.495c.673-1.167 2.357-1.167 3.03 0l6.28 10.875c.673 1.167-.17 2.625-1.516 2.625H3.72c-1.347 0-2.189-1.458-1.515-2.625L8.485 2.495ZM10 5a.75.75 0 0 1 .75.75v3.5a.75.75 0 0 1-1.5 0v-3.5A.75.75 0 0 1 10 5Zm0 9a1 1 0 1 0 0-2 1 1 0 0 0 0 2Z"
                            clip-rule="evenodd"></path>
                        </svg>
                    </div>
                    {{ end }}
                    {{ else }}
                    <div><span class="color-negative">No data</span></div>
                    <div class="monitor-site-status-icon-compact" title="No data available">
                        <svg fill="var(--color-negative)" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                        <path d="M10 18a8 8 0 1 1 0-16 8 8 0 0 1 0 16zm0-2a6 6 0 1 0 0-12 6 6 0 0 0 0 12zm-.75-8a.75.75 0 0 1 1.5 0v3a.75.75 0 0 1-1.5 0V8zm.75 5a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
                        </svg>
                    </div>
                    {{ end }}
                </div>
                {{ end }}
                {{ end }}
                </ul>
                {{ end }}
 
               # https://github.com/glanceapp/community-widgets/blob/main/widgets/beszel-server-stats/README.md

                - type: custom-api
                title: Server Stats
                cache: 5m
                options:
                    base-url: ${BESZEL_URL}
                    api-key: ${BESZEL_TOKEN}
                template: |
                    {{/* Required config options */}}
                    {{ $baseURL := .Options.StringOr "base-url" "" }}
                    {{ $apiKey := .Options.StringOr "api-key" "" }}
  
                    {{/* Error message template */}}
                    {{ define "errorMsg" }}
                    <div class="widget-error-header">
                        <div class="color-negative size-h3">ERROR</div>
                        <svg class="widget-error-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"></path>
                        </svg>
                    </div>
                    <p class="break-all">{{ . }}</p>
                    {{ end }}
  
                    {{ define "formatGigabytes" }}
                    {{ $value := . }}
                    {{ $label := "GB" }}
                    {{- if lt $value 1.0 }}
                        {{ $value = mul $value 1000.0 }}
                        {{ $label = "MB" }}
                    {{- else if lt $value 1000.0 }}
                    {{ else }}
                        {{ $value = div $value 1000.0 }}
                        {{ $label = "TB" }}
                    {{ end }}
                    {{ printf "%.1f" $value }} <span class="color-base size-h5">{{ $label }}</span>
                    {{ end }}
  
                    {{/* Check required fields */}}
                    {{ if or (eq $baseURL "") (eq $apiKey "") }}
                    {{ template "errorMsg" "Some required options are not set." }}
                    {{ else }}
  
                    {{ $token := concat "Bearer " $apiKey }}
  
                    {{ $systemsResponse := newRequest (print $baseURL "/api/collections/systems/records")
                        | withHeader "Authorization" $token
                        | getResponse }}
                    {{ $systems := $systemsResponse.JSON.Array "items" }}
  
  
                    {{ range $n, $system := $systems }}
                        {{ $status := $system.String "status" }}
  
                        {{ $systemStatsRequest := newRequest (print $baseURL "/api/collections/system_stats/records")
                            | withHeader "Authorization" $token
                            | withParameter "sort" "-created"
                            | withParameter "page" "1"
                            | withParameter "perPage" "1"
                            | withParameter "filter" (print "type='1m'&&system='" ($system.String "id") "'")
                            | getResponse }}
  
                        {{ $systemStatItems := $systemStatsRequest.JSON.Array "items" }}
  
                        {{ $hostname := $system.String "name" }}
                        {{ $uptimeSec := $system.Float "info.u" }}
  
                        {{ $systemTemp := $system.Float "info.dt"}}
  
                        {{ $cpuLoad := $system.Float "info.cpu" }}
                        {{ $cpuLoad1m := $system.Float "info.l1" }}
                        {{ $cpuLoad15m := $system.Float "info.l15" }}
  
                        {{ $memoryUsedPercent := $system.Float "info.mp" }}
  
                        {{ $rootUsedPercent := $system.Float "info.dp" }}
  
                        {{ $hasStats := false }}
                        {{ $systemStats := "" }}
  
                        {{ $memoryTotalGb := 0.0 }}
                        {{ $memoryUsedGb := 0.0 }}
                        {{ $swapTotalGb := 0.0 }} 
                        {{ $swapUsedGb := 0.0 }}
                        {{ $swapUsedPercent := 0.0 }}
                        {{ $rootTotalGb := 0.0 }}
                        {{ $rootUsedGb := 0.0 }}
  
                        {{ if gt (len $systemStatItems) 0 }}
                        {{ $hasStats = true }}
                        {{ $systemStats = index $systemStatItems 0 }}
  
                        {{ $memoryTotalGb = $systemStats.Float "stats.m" }}
                        {{ $memoryUsedGb = $systemStats.Float "stats.mu" }}
  
                        {{ $swapTotalGb = $systemStats.Float "stats.s" }}
                        {{ $swapUsedGb = $systemStats.Float "stats.su" }}
                        {{ $swapUsedPercent = mul (div $swapUsedGb $swapTotalGb) 100.0 }}
  
                        {{ $rootTotalGb = $systemStats.Float "stats.d" }}
                        {{ $rootUsedGb = $systemStats.Float "stats.du" }}
                        {{ end }}
  
                        <div class="server">
                        <div class="server-info">
                            <div class="server-details">
                            <div class="server-name color-highlight size-h3">{{ $hostname }}</div>
                            <div>
                                {{ if eq $status "up" }}
                                <span>{{ printf "%.1f" (mul $uptimeSec 0.000011574) }}d</span> uptime
                                {{ else }}
                                unreachable
                                {{ end }}
                            </div>
                            </div>
                            <div class="shrink-0"{{ if eq $status "up" }} data-popover-type="html" data-popover-margin="0.2rem" data-popover-max-width="400px"{{ end }}>
                            {{- if eq $status "up" }}
                            <div data-popover-html>
                                <div class="flex">
                                <div class="size-h5 text-compact">Kernel</div>
                                <div class="value-separator"></div>
                                <div class="color-highlight">{{ $system.String "info.k" }}</div>
                                </div>
                                <div class="flex">
                                <div class="size-h5 text-compact">CPU</div>
                                <div class="value-separator"></div>
                                <div class="color-highlight">{{ $system.String "info.m" }}</div>
                                </div>
                            </div>
                            {{- end }}
                            <svg class="server-icon" stroke="var(--color-{{ if eq $status "up" }}positive{{ else }}negative{{ end }})" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M21.75 17.25v-.228a4.5 4.5 0 0 0-.12-1.03l-2.268-9.64a3.375 3.375 0 0 0-3.285-2.602H7.923a3.375 3.375 0 0 0-3.285 2.602l-2.268 9.64a4.5 4.5 0 0 0-.12 1.03v.228m19.5 0a3 3 0 0 1-3 3H5.25a3 3 0 0 1-3-3m19.5 0a3 3 0 0 0-3-3H5.25a3 3 0 0 0-3 3m16.5 0h.008v.008h-.008v-.008Zm-3 0h.008v.008h-.008v-.008Z" />
                            </svg>
                            </div>
                        </div>
  
                        <div class="server-stats">
                            <div class="flex-1">
                            <div class="flex items-end size-h5">
                                <div>CPU</div>
                                {{- if ge $systemTemp 80.0 }}
                                <svg class="server-spicy-cpu-icon" fill="var(--color-negative)" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" >
                                <path fill-rule="evenodd" d="M8.074.945A4.993 4.993 0 0 0 6 5v.032c.004.6.114 1.176.311 1.709.16.428-.204.91-.61.7a5.023 5.023 0 0 1-1.868-1.677c-.202-.304-.648-.363-.848-.058a6 6 0 1 0 8.017-1.901l-.004-.007a4.98 4.98 0 0 1-2.18-2.574c-.116-.31-.477-.472-.744-.28Zm.78 6.178a3.001 3.001 0 1 1-3.473 4.341c-.205-.365.215-.694.62-.59a4.008 4.008 0 0 0 1.873.03c.288-.065.413-.386.321-.666A3.997 3.997 0 0 1 8 8.999c0-.585.126-1.14.351-1.641a.42.42 0 0 1 .503-.235Z" clip-rule="evenodd" />
                                </svg>
                                {{- end }}
                                <div class="color-highlight margin-left-auto text-very-compact">{{ $cpuLoad }} <span class="color-base">%</span></div>
                            </div>
                            <div data-popover-type="html">
                                <div data-popover-html>
                                <div class="flex">
                                    <div class="size-h5">1M AVG</div>
                                    <div class="value-separator"></div>
                                    <div class="color-highlight text-very-compact">{{ printf "%.1f" $cpuLoad1m }} <span class="color-base size-h5">%</span></div>
                                </div>
                                <div class="flex margin-top-3">
                                    <div class="size-h5">15M AVG</div>
                                    <div class="value-separator"></div>
                                    <div class="color-highlight text-very-compact">{{ printf "%.1f" $cpuLoad15m }} <span class="color-base size-h5">%</span></div>
                                </div>
                                <div class="flex margin-top-3">
                                    <div class="size-h5">TEMP C</div>
                                    <div class="value-separator"></div>
                                    <div class="color-highlight text-very-compact">{{ printf "%.1f" $systemTemp }} <span class="color-base size-h5">°</span></div>
                                </div>
                                </div>
  
                                <div class="progress-bar progress-bar-combined">
                                <div class="progress-value{{ if ge $cpuLoad1m 85.0 }} progress-value-notice{{ end }}" style="--percent: {{ $cpuLoad1m }}"></div>
                                <div class="progress-value{{ if ge $cpuLoad15m 85.0 }} progress-value-notice{{ end }}" style="--percent: {{ $cpuLoad15m }}"></div>
                                </div>
                            </div>
                            </div>
  
                            <div class="flex-1">
                            <div class="flex justify-between items-end size-h5">
                                <div>RAM</div>
                                <div class="color-highlight text-very-compact">{{ $memoryUsedPercent }} <span class="color-base">%</span></div>
                            </div>
                            <div data-popover-type="html">
                                {{- if $hasStats }}
                                <div data-popover-html>
                                <div class="flex">
                                    <div class="size-h5">RAM</div>
                                    <div class="value-separator"></div>
                                    <div class="color-highlight text-very-compact">
                                    {{ template "formatGigabytes" $memoryUsedGb }} <span class="color-base size-h5">/</span> {{ template "formatGigabytes" $memoryTotalGb }}
                                    </div>
                                </div> 
                                {{- if gt $swapTotalGb 0.0 }}
                                <div class="flex margin-top-3">
                                    <div class="size-h5">SWAP</div>
                                    <div class="value-separator"></div>
                                    <div class="color-highlight text-very-compact">
                                    {{ template "formatGigabytes" $swapUsedGb }} <span class="color-base size-h5">/</span> {{ template "formatGigabytes" $swapTotalGb }}
                                    </div>
                                </div>
                                {{- end }}
                                </div>
                                {{- end }}
                                <div class="progress-bar progress-bar-combined">
                                <div class="progress-value{{ if ge $memoryUsedPercent 85.0 }} progress-value-notice{{ end }}" style="--percent: {{ $memoryUsedPercent }}"></div>
                                {{- if gt $swapTotalGb 0.0 }}
                                <div class="progress-value{{ if ge $swapUsedPercent 85.0 }} progress-value-notice{{ end }}" style="--percent: {{ $swapUsedPercent }}"></div>
                                {{- end }}
                                </div>
                            </div>
                            </div>
  
                            <div class="flex-1">
                            <div class="flex justify-between items-end size-h5">
                                <div>DISK</div>
                                <div class="color-highlight text-very-compact">{{ $rootUsedPercent }} <span class="color-base">%</span></div>
                            </div>
                            <div data-popover-type="html">
                                {{- if $hasStats }}
                                <div data-popover-html>
                                <ul class="list list-gap-2">
                                    <li class="flex">
                                    <div class="size-h5">/</div>
                                    <div class="value-separator"></div>
                                    <div class="color-highlight text-very-compact">
                                        {{ template "formatGigabytes" $rootUsedGb }} <span class="color-base size-h5">/</span> {{ template "formatGigabytes" $rootTotalGb }}
                                    </div>
                                    </li>
                                    {{ range $key, $efs := ($systemStats.Get "stats.efs").Map }}
                                        <li class="flex">
                                        <div class="size-h5">{{ $key }}</div>
                                        <div class="value-separator"></div>
                                        <div class="color-highlight text-very-compact">
                                            {{ template "formatGigabytes" (($efs.Get "du").Float) }} <span class="color-base size-h5">/</span> {{ template "formatGigabytes" (($efs.Get "d").Float) }}
                                        </div>
                                        </li>
                                    {{ end }}
                                </ul>
                                </div>
                                {{- end }}
                                <div class="progress-bar progress-bar-combined">
                                <div class="progress-value{{ if ge $rootUsedPercent 85.0 }} progress-value-notice{{ end }}" style="--percent: {{ $rootUsedPercent }}"></div>
                                {{ range $key, $efs := ($system.Get "info.efs").Map }}
                                    {{ $percent := $efs.Float }}
                                    <div class="progress-value{{ if ge $percent 85.0 }} progress-value-notice{{ end }}" style="--percent: {{ $percent }}"></div>
                                {{ end }}
                                </div>
                            </div>
                            </div>
  
                        </div>
                        </div>
                    {{ end }}
                    {{ end }}


      # -----------------------
      # FULL COLUMN
      # -----------------------
      - size: full
        widgets:

       # https://github.com/glanceapp/community-widgets/tree/main/widgets/nginx-proxy-manager

        - type: custom-api
        title: Nginx Proxy Manager
        cache: 12h
        url: ${NGINX_PROXY_URL}/api/tokens
        method: POST
        body-type: json
        body:
            identity: ${NGINX_EMAIL_ID}
            secret: ${NGINX_PASSWORD}
        options:
            collapse-after: 6
            show-icons: true
            domain-name: ".example.com" # this is your top level DNS domain name
            tooltip-enabled: true
            #  if you want custom icons add here [either simple icon id or full url]
            code: coder
            paperless: paperlessngx
            docker: docker
            glance: https://cdn.jsdelivr.net/gh/selfhst/icons/svg/glance-dark.svg
            portainer: portainer

        template: |
            <style>
            .widget-type-nginx li {
                margin-top: var(--list-half-gap); 
                border-top: 1px solid var(--color-separator);
                padding-top: var(--list-half-gap);
            }
            .widget-ngix-proxy-icon, .widget-ngix-proxy-icon-default  {
                display: block;
                filter: grayscale(0.4);
                object-fit: contain;
                aspect-ratio: 1 / 1;
                width: 2.7rem;
                opacity: 0.8;
                transition: filter 0.3s, opacity 0.3s;
            }
            // DISABLE THE BELOW CSS FOR COLOR ICONS 
            :root[data-scheme="dark"] .widget-ngix-proxy-icon {
                filter: invert(100%); // this to invert colors for dark and light theme 
            } 
            </style>

            {{ $defaultIconUrl := "https://cdn.jsdelivr.net/gh/selfhst/icons/svg/nginx-proxy-manager.svg" }}
       
            {{ if eq .Response.StatusCode 200 }}
            {{ $accessToken := .JSON.String "token" }}
            {{
                $proxyHosts := newRequest (concat "${NGINX_PROXY_URL}" "/api/nginx/proxy-hosts")
                | withHeader "Authorization" (print "Bearer " $accessToken)
                | getResponse
            }}
            <ul  class="dynamic-columns list list-gap-15 list-with-separator  collapsible-container"  data-collapse-after="{{ .Options.IntOr "collapse-after" 6 }}">
                {{ range $proxyHosts.JSON.Array "" }}
                {{ if and (.String "domain_names.0") (.Bool "enabled")  }}
            
                    {{ $proxy_url  := (concat (.String "forward_scheme") "://" (.String "domain_names.0") ) }}
                    {{ $host_url   := (concat (.String "forward_scheme") "://" (.String "forward_host") ":" (.String "forward_port") ) }}
                    {{ $subDomain  := .String "domain_names.0" | trimSuffix ($.Options.StringOr "domain-name" "") }}

                    <li class="flex items-center gap-20" >
                    <!-- Icon Section -->
                    {{ if $.Options.BoolOr "show-icons" true }}
                        <div class="shrink-0">
                            {{ $iconUrl := $.Options.StringOr $subDomain $defaultIconUrl}}
                            {{ if eq $iconUrl $defaultIconUrl }}
                            <img class="widget-ngix-proxy-icon-default" src="{{ $defaultIconUrl }}" loading="lazy">
                            {{ else }}
                            {{ if ne (findMatch "://" $iconUrl)  "://" }} <!-- check if url is NOT provided -->
                                <img class="widget-ngix-proxy-icon" src="https://simpleicons.org/icons/{{$iconUrl}}.svg" loading="lazy">
                            {{ else }}
                                <img class="widget-ngix-proxy-icon" src="{{ $iconUrl }}" loading="lazy">
                            {{ end }}
                            {{ end }}
                        </div>
                    {{ end }}

                    <!-- Proxy URLs Section -->
                    <div class="min-width-0 grow">
                        <a href='{{ $proxy_url }}' class="color-highlight size-title-dynamic block" style="display: inline;" target="_blank" rel="noreferrer"
                            {{if $.Options.BoolOr "tooltip-enabled" false}}data-popover-type="text" data-popover-text="{{$proxy_url}}"{{end}}
                        >{{ $subDomain }}</a>
                        <div class="flex items-center gap-10" style="margin-bottom: 5px">
                        <div class="text-left">
                                ➔
                        </div>
                        <div class="size-h6 flex-1 text-left">
                            <a href='{{ $host_url }}' target="_blank" rel="noreferrer">{{ $host_url }}</a>
                        </div>
                        </div>
                    </div>
                    </li>
                {{ end }}
                {{ end }}
            </ul>

            {{ else }}
            <p class='color-negative'>Failed to get token: {{ .JSON.String "error.message" }} ({{ $.Response.Status }}) </p>
            {{ end }}


          # https://github.com/glanceapp/glance/blob/main/docs/configuration.md#reddit

          - type: group
            define: &shared-properties
                type: reddit
                show-thumbnails: true
                collapse-after: 5
            widgets:
              - subreddit: selfhosted
                <<: *shared-properties
              - subreddit: homelab
                <<: *shared-properties



      # -----------------------
      # SMALL COLUMN
      # -----------------------
      - size: small
        widgets:

          # https://github.com/glanceapp/community-widgets/tree/main/widgets/crafty-controller-minecraft-server

            - type: custom-api
            title: Crafty Controller - Minecraft Server
            cache: 5s
            options:
                base-url: ${CRAFTY_URL}
                api-key: ${CRAFTY_API_TOKEN}
                server-id: ${CRAFTY_SERVER_ID}
                display-MOTD: true
            allow-insecure: true
            template: |
                {{/* Required config options */}}
                {{ $baseURL := .Options.StringOr "base-url" "" }}
                {{ $apiKey := .Options.StringOr "api-key" "" }}
                {{ $serverID := .Options.StringOr "server-id" "" }}

                {{/* Optional config options */}}
                {{ $displayMOTD := .Options.BoolOr "display-MOTD" true }}

                {{ $serverStats := newRequest (print $baseURL "/api/v2/servers/" $serverID "/stats")
                    | withHeader "Authorization" (print "Bearer " $apiKey)
                    | withHeader "Accept" "application/json"
                    | getResponse }}

                {{ $is_running :=  $serverStats.JSON.Bool "data.running" }}
                {{ $online_players :=  $serverStats.JSON.Int "data.online" | formatNumber }}
                {{ $max_players :=  $serverStats.JSON.Int "data.max" | formatNumber }}
                {{ $name :=  $serverStats.JSON.String "data.world_name" }}
                {{ $size :=  $serverStats.JSON.String "data.world_size" }}
                {{ $version :=  $serverStats.JSON.String "data.version" }}
                {{ $icon :=  $serverStats.JSON.String "data.icon" }}
                {{ $server_ip :=  $serverStats.JSON.String "data.server_id.server_ip" }}
                {{ $server_port :=  $serverStats.JSON.String "data.server_id.server_port" }}
                {{ $motd :=  $serverStats.JSON.String "data.desc" }}

                {{ $server_addr := "" }}
                {{ if and ($is_running) (eq $server_ip "127.0.0.1") }}
                {{ $server_addr = printf "%s:%s" (replaceMatches "https?://" "" $baseURL) $server_port }}
                {{ else if $is_running }}
                {{ $server_addr = printf "%s:%s" $server_ip $server_port }}
                {{ end }}

                {{ $starting := false }}
                {{ if and ($is_running) (eq $max_players "0") (eq $version "False") }}
                {{ $starting = true }}
                {{ end }}

                <!-- I couldn't find documentation describing the "waiting_start" state or the other booleans below. Implementation might not be correct. -->
                {{ $updating :=  $serverStats.JSON.Bool "data.updating" }}
                {{ $importing :=  $serverStats.JSON.Bool "data.importing" }}
                {{ $crashed :=  $serverStats.JSON.Bool "data.crashed" }}

                <div style="display:flex; align-items:center; gap:12px;">
                <!-- Server Icon -->
                <div style="width:40px; height:40px; flex-shrink:0; border-radius:4px; display:flex; justify-content:center; align-items:center; overflow:hidden;">
                    {{ if eq $icon "" }}
                    <img src="https://cdn.jsdelivr.net/gh/selfhst/icons/png/minecraft.png" style="width:100%; height:100%; object-fit:contain;" alt="Server icon">
                    {{ else }}
                    <img src="data:image/png;base64, {{ $icon }}" style="width:100%; height:100%; object-fit:contain;" alt="Server icon">
                    {{ end }}
                </div>

                <!-- Right side: Info -->
                <div style="display:flex; flex-direction:column;">
                    <!-- First row: Server Name + IP -->
                    <div style="display:flex; align-items:center; gap:6px;">
                    <span class="size-h4 block text-truncate color-primary">
                        {{ $name }}
                    </span>

                    {{ if and ($is_running) (not $starting) (not (eq $server_addr "")) }}
                    <div style="font-size:0.9em; color:var(--color-secondary);">
                        <span class="size-h6 color-secondary">
      	         - {{ $server_addr }}
                        </span>
                    </div>
                    {{ end }}
                    </div>

                    <!-- Second row: MOTD & Stats if server is running, otherwise show status msg  ... -->
                    {{ if and ($is_running) (not $starting) }}
                    {{ if and (not (eq $motd "")) ($displayMOTD) }}
                        <div style="font-size:0.9em; color:var(--color-secondary);">
      	         {{ replaceMatches "§." "" $motd }}
                        </div>
                    {{ end }}

                    <div style="font-size:0.9em; color:var(--color-secondary);">
                        {{ $version }} - {{ $online_players }}/{{ $max_players }} players - {{ $size }}
                    </div>

                    <!-- lots of assumptions about the boolean states meanings from crafty api.. -->
                    {{ else if $starting }}
                    <div style="font-size:0.9em; color:var(--color-secondary);">Server is starting up..</div>
                    {{ else if $importing }}
                    <div style="font-size:0.9em; color:var(--color-secondary);">Server is being imported..</div>
                    {{ else if $updating }}
                    <div style="font-size:0.9em; color:var(--color-secondary);">Server is being updated..</div>
                    {{ else if $crashed }}
                    <div style="font-size:0.9em; color:var(--color-secondary);">Server has crashed!</div>
                    {{ else }}
                    <div style="font-size:0.9em; color:var(--color-secondary);">Server is offline</div>
                    {{ end }}
                </div>
                </div>
              
          # https://github.com/glanceapp/glance/blob/main/docs/configuration.md#releases
          #- type: releases
          #  hide-header: true
          #  cache: 1d
          #  show-source-icon: true
          #  token: ${GITHUB_TOKEN}
          #  collapse-after: 10
          #  limit: 25
          #  repositories:
          #   - go-gitea/gitea
          #   - jellyfin/jellyfin
          #   - glanceapp/glance
          #   - codeberg:redict/redict
          #   - gitlab:fdroid/fdroidclient
          #   - dockerhub:gotify/server
